#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <time.h>

bool in_inner(char* text, char symbol){
    if(text == 0) return true;
    for(int i = 0; i < strlen(text); i++){
        if(text[i] == symbol)
            return false;
    }
    return true;
}
char* get_4digitnum(){             
    char* digitnum = malloc(4); 
    int dig = 0;
    srand(time(0)); 
    while(strlen(digitnum) < 4){   
        char m = rand() % 8 + '0';   
        if(in_inner(digitnum, m))
            digitnum[dig++] = m;           
    }
    return digitnum;
}

int gut_p(char* text_1, char* text_2)  {   
    int gut = 0;
    for(int k = 0; k < strlen(text_1); k++){
        if(text_1[k] == text_2[k])
            gut++;
    }
    return gut;
}

bool in_revision(char* str){ 
    for(int i = 0; i < strlen(str) - 1; i++){
        for(int j = i + 1; j < strlen(str); j++){
            if(str[i] == str[j])
                return true;
        }
    }
    return false;
}

bool wrong_input(char* text){ 
    if(strlen(text) < 4) return true;
    int i = 0;
    while(text[i] != '\0'){
        if(text[i] > '7' || text[i] < '0' || in_inner(text,*text))
            return true;
        i++;
    }
    return false;
}

int zn_p(char* text_1, char* text_2){   
    int zn = 0;
    for(int j = 0; text_1[j] != '\0'; j++){
        if(!in_inner(text_1, text_2[j]) && text_1[j] != text_2[j])
            zn++;
    }
    return zn;
}

int main(int ac, char *av[]){
    char* secret = malloc(4);
    char* cin = malloc(16);
    int rounds_number = 10;
    int round = 0;
    if (ac == 3) {
        if(strcmp("-t", av[1]) == 0){
            rounds_number = atoi(av[2]);
            secret = get_4digitnum();
        }
        if(strcmp("-c", av[1]) == 0) {
            secret = av[2];
        }
    } else {
        secret = get_4digitnum();
    }     
    printf("Will you find the secret code\n");
    while(round <= rounds_number){
        printf("- - -\nRound %d\n >", round);
        scanf("%s", cin);
        if(wrong_input(cin)){
            printf("Wrong input!\n");
            continue;
        }
        int gp = gut_p(secret, cin);
        int zp = zn_p(secret, cin);
        if(gp == 4){
            printf("Congratz! You did it!\n");
            break;
        } else {
            printf("Well placed pieces: %d\n", gp);
            printf("Misplaced pieces: %d\n", zp);
        }
        round++;
    }
    return 0;
}
